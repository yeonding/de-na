<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>게임 캐릭터</title>
    <link href="../css/game.css" type="text/css" rel="stylesheet">
    <style>
      canvas {
        border: 1px solid black;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas" width="1024" height="576"></canvas>
    <div id="characterSelection">
        <div class="characters">
            <img src="../images/player/ch1/ch1.gif" id="ch1">
            <img src="../images/player/ch2/front.png" id="ch2">
            <img src="../images/player/ch3/move1.gif" id="ch3">
            <img src="../images/mob/WalkPreview.gif" id="ch4">    
            <img src="../images/mob/mob1.gif" id="ch5">  
        </div> 
        <p id="start-button"><img src="../images/logo/gamestart1.png"></p>
    </div>
    <script>
      var canvas = document.getElementById("canvas");
      var ctx = canvas.getContext("2d");

        //캐릭터 선택
        const ch1 = document.getElementById('ch1');
        const ch2 = document.getElementById('ch2');
        const ch3 = document.getElementById('ch3');
        const ch4 = document.getElementById('ch4');
        const ch5 = document.getElementById('ch5');

        const startButton = document.getElementById('start-button');
        startButton.style.display = 'none'; // 시작 버튼은 처음에 보이지 않음

        let selectedCharacter = null;

ch1.addEventListener('click', function() {
  // 캐릭터1을 선택했을 때
  console.log('캐릭터1을 선택했습니다.');
  selectedCharacter = ch1;
  startButton.style.display = 'block';
});

ch2.addEventListener('click', function() {
  // 캐릭터2을 선택했을 때
  console.log('캐릭터2을 선택했습니다.');
  selectedCharacter = ch2;
  startButton.style.display = 'block';
});

ch3.addEventListener('click', function() {
  // 캐릭터3을 선택했을 때
  console.log('캐릭터3을 선택했습니다.');
  selectedCharacter = ch3;
  startButton.style.display = 'block';
});

ch4.addEventListener('click', function() {
    // 캐릭터4를 선택했을 때
    console.log('캐릭터4을 선택했습니다.');
    selectedCharacter = ch4;
    startButton.style.display = 'block';
  });

ch5.addEventListener('click', function() {
    // 캐릭터5를 선택했을 때
    console.log('캐릭터5을 선택했습니다.');
    selectedCharacter = ch5;
    startButton.style.display = 'block';
  });  

//게임시작
const characterSeletion = document.getElementById('characterSelection');

function startGame() {
    //캐릭터 선택 화면 숨기기
    characterSeletion.classList.add("hidden");
     
}

      const ch1Front = new Image();
      ch1Front.src = "../images/player/ch1/spriteFront.png";
      const ch1Back = new Image();
      ch1Back.src = "../images/player/ch1/spriteBack.png";
      const ch1Left = new Image();
      ch1Left.src = "../images/player/ch1/spriteLeft.png";
      const ch1Right = new Image();
      ch1Right.src = "../images/player/ch1/spriteRight.png"; 
      const ch1Stop = new Image();
      ch1Stop.src = "../images/player/ch1/spriteStop.png"


      var characterX = canvas.width / 2;
      var characterY = canvas.height / 2;
      var characterSpeed = 3;
      var characterDirection = "stop"; // 캐릭터의 초기 방향은 멈춤

      function drawCharacter() {
        var frameIndex = 4; // 스프라이트 이미지에서 사용할 프레임 인덱스
        var spriteX = 0; // 스프라이트 이미지에서 사용할 x 좌표
        var spriteY = 0; // 스프라이트 이미지에서 사용할 y 좌표

        if (characterDirection === "stop") {
            frameIndex = Math.floor(Date.now() / 500) % 2;
            spriteX = frameIndex*48;
            //characterX -= characterSpeed;
        }

        if (characterDirection === "left") {
            frameIndex = Math.floor(Date.now() / 100) % 4;
            //spriteX = 0
            spriteX = frameIndex * 48;
            characterX -= characterSpeed;
        }

        if (characterDirection === "up") {
            frameIndex = Math.floor(Date.now() / 100) % 4;
            //spriteX = 0
            spriteX = frameIndex * 48;
            characterY -= characterSpeed;
            }

            if (characterDirection === "down") {
            frameIndex = Math.floor(Date.now() / 100) % 4;
            //spriteX = 0
            spriteX = frameIndex * 48;
            characterY += characterSpeed;
            }

         else if (characterDirection === "right") {
            frameIndex = Math.floor(Date.now() / 100) % 4;
            //spriteX = 0
            spriteX = frameIndex * 48;
            characterX += characterSpeed;
        } 
      
        if (characterDirection == 'stop')
        ctx.drawImage(ch1Stop, spriteX, spriteY, 48, 48, characterX, characterY, 48, 48);

        if (characterDirection == 'up')
        ctx.drawImage(ch1Back, spriteX, spriteY, 48, 48, characterX, characterY, 48, 48);

        if (characterDirection == 'down')
        ctx.drawImage(ch1Front, spriteX, spriteY, 48, 48, characterX, characterY, 48, 48);
    
        if (characterDirection === "left") {
        ctx.drawImage(ch1Left, spriteX, spriteY, 48, 48, characterX, characterY, 48, 48);
        }

        if (characterDirection === "right") {
        ctx.drawImage(ch1Right, spriteX, spriteY, 48, 48, characterX, characterY, 48, 48);
        }
       
        
      }

      function drawBackground() {
        ctx.fillStyle = "#55f";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      }

      function gameLoop() {
          drawBackground();
          drawCharacter();
          requestAnimationFrame(gameLoop);
        }
        
        startGame()
        gameLoop();


      document.addEventListener("keydown", function(event) {
        if (event.keyCode === 37) { // 왼쪽 방향키를 눌렀을 때
          characterDirection = "left";
        } else if (event.keyCode === 39) { // 오른쪽 방향키를 눌렀을 때
          characterDirection = "right";
        }
        else if (event.keyCode === 38) { // 위 방향키를 눌렀을 때
          characterDirection = "up";
        }
        else if (event.keyCode === 40) { // 아래 방향키를 눌렀을 때
          characterDirection = "down";
        }
      });

      document.addEventListener("keyup", function(event) {
        if (event.keyCode === 37 || event.keyCode === 39 || event.keyCode === 38 || event.keyCode === 40) { // 왼쪽 또는 오른쪽 방향키를 떼었을 때
          characterDirection = "stop";
        }
      });
    </script>
  </body>
</html>
